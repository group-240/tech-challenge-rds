name: "Auto Create PR: feature -> develop"

on:
  push:
    # Trigger for branches that start with 'feature/' or 'feature'
    branches:
      - 'feature/**'
      - 'feature*'

permissions:
  contents: write

jobs:
  create-pr:
    name: Create PR to develop
    runs-on: ubuntu-latest

    steps:
      - name: Create PR from feature branch into develop (if none exists)
        uses: actions/github-script@v6
        with:
          script: |
            const head = context.ref.replace('refs/heads/', '');
            const base = 'develop';
            const title = 'Automated PR: ' + head + ' -> ' + base;
            const body = 'Automated PR from ' + head + ' into ' + base + '.';

            if (context.actor === 'github-actions') {
              console.log('Triggered by github-actions; skipping PR creation.');
              return;
            }

            const { owner, repo } = context.repo;

            const existing = await github.rest.pulls.list({ owner, repo, head: owner + ':' + head, base, state: 'open' });
            if (existing.data && existing.data.length > 0) {
              console.log('An open PR already exists: ' + existing.data[0].html_url);
              return;
            }

            const pr = await github.rest.pulls.create({ owner, repo, title, head, base, body });
            console.log('Created PR: ' + pr.data.html_url);
