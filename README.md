# ğŸ—„ï¸ Tech Challenge - RDS PostgreSQL

RepositÃ³rio responsÃ¡vel pelo banco de dados PostgreSQL (RDS) na AWS.

## ğŸ“ Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  AWS Cloud                                           â”‚
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                         VPC (tech-challenge-vpc)                               â”‚ â”‚
â”‚   â”‚                                                                                â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚   â”‚                    Private Subnets                                       â”‚ â”‚ â”‚
â”‚   â”‚   â”‚                                                                          â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚                    DB Subnet Group                               â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚   â”‚  Private Subnet   â”‚       â”‚  Private Subnet   â”‚             â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   us-east-1a      â”‚       â”‚   us-east-1b      â”‚             â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚   â”‚  10.0.10.0/24     â”‚       â”‚  10.0.11.0/24     â”‚             â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚                                                                  â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚      RDS PostgreSQL Instance        â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚                                     â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚  Instance: db.t3.micro              â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚  Engine: PostgreSQL 18.1            â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚  Storage: 20GB                      â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚  Multi-AZ: false                    â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚                                     â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚  Databases:                         â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚  â”œâ”€â”€ techchallenge (orders)         â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚  â””â”€â”€ techchallengecustomers         â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â”‚                                     â”‚                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â”‚                        â”‚                                        â”‚   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â”‚
â”‚   â”‚   â”‚                            â”‚                                            â”‚ â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚                                â”‚                                              â”‚ â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚   â”‚            Security Group (tech-challenge-rds-sg)                       â”‚ â”‚ â”‚
â”‚   â”‚   â”‚                            â”‚                                            â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  Inbound Rules:            â”‚                                            â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  â”œâ”€â”€ Port 5432 from EKS Security Group                                  â”‚ â”‚ â”‚
â”‚   â”‚   â”‚  â””â”€â”€ Port 5432 from VPC CIDR (10.0.0.0/16)                             â”‚ â”‚ â”‚
â”‚   â”‚   â”‚                            â”‚                                            â”‚ â”‚ â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â”‚                                â”‚                                              â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                 â”‚
                    â–¼                                 â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Customer Serviceâ”‚               â”‚ Orders Service  â”‚
          â”‚                 â”‚               â”‚                 â”‚
          â”‚ Uses:           â”‚               â”‚ Uses:           â”‚
          â”‚ techchallenge   â”‚               â”‚ techchallenge   â”‚
          â”‚   customers     â”‚               â”‚                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— ComunicaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONEXÃƒO EKS â†’ RDS                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                        EKS Nodes                                  â”‚
  â”‚                                                                   â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
  â”‚   â”‚  Customer Pod      â”‚      â”‚   Orders Pod       â”‚             â”‚
  â”‚   â”‚                    â”‚      â”‚                    â”‚             â”‚
  â”‚   â”‚  JDBC Connection:  â”‚      â”‚  JDBC Connection:  â”‚             â”‚
  â”‚   â”‚  jdbc:postgresql://â”‚      â”‚  jdbc:postgresql://â”‚             â”‚
  â”‚   â”‚  {DB_HOST}:5432/   â”‚      â”‚  {DB_HOST}:5432/   â”‚             â”‚
  â”‚   â”‚  techchallengecust â”‚      â”‚  techchallenge     â”‚             â”‚
  â”‚   â”‚                    â”‚      â”‚                    â”‚             â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
  â”‚             â”‚                           â”‚                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                           â”‚
                â”‚    Private Network        â”‚
                â”‚    (10.0.10.0/24)         â”‚
                â”‚                           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  RDS PostgreSQL â”‚
                    â”‚                 â”‚
                    â”‚  Endpoint:      â”‚
                    â”‚  tech-challenge-â”‚
                    â”‚  db.xxx.rds.    â”‚
                    â”‚  amazonaws.com  â”‚
                    â”‚                 â”‚
                    â”‚  Port: 5432     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ O que este repositÃ³rio cria

| Recurso | DescriÃ§Ã£o |
|---------|-----------|
| `aws_db_instance.postgres` | InstÃ¢ncia RDS PostgreSQL |
| `aws_db_subnet_group.db_subnet_group` | Grupo de subnets para RDS |
| `aws_security_group.rds_sg` | Security Group do RDS |

## ğŸ“‹ Outputs Exportados

| Output | DescriÃ§Ã£o | Usado Por |
|--------|-----------|-----------|
| `db_host` | Endpoint do RDS | Customer, Orders |
| `db_port` | Porta do PostgreSQL (5432) | Customer, Orders |
| `db_name` | Nome do banco de dados | Customer, Orders |

## ğŸ“¦ DependÃªncias (Remote State)

```hcl
# Infra (VPC e Subnets)
data "terraform_remote_state" "infra" {
  backend = "s3"
  config = {
    bucket = "tech-challenge-tfstate-group240"
    key    = "infra/terraform.tfstate"
    region = "us-east-1"
  }
}
```

## ğŸ” Secrets NecessÃ¡rios (GitHub)

- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCESS_KEY`
- `AWS_SESSION_TOKEN` (obrigatÃ³rio para AWS Academy Learner Lab)
- `DB_USERNAME` - UsuÃ¡rio do PostgreSQL
- `DB_PASSWORD` - Senha do PostgreSQL

## ğŸš€ Como usar

```bash
cd terraform
terraform init
terraform plan
terraform apply
```
